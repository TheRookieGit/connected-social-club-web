(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2982:function(e,t,s){Promise.resolve().then(s.bind(s,4942))},4942:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return C}});var a=s(7437),r=s(2265),l=s(9376),n=s(3287),c=s(2718),i=s(2369),o=s(9763);let d=(0,o.Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var x=s(6595),h=s(8997);let m=(0,o.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var u=s(1047);function f(e){let{user:t}=e,[s,l]=(0,r.useState)(0);return(0,a.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-lg overflow-hidden card-hover",children:[(0,a.jsxs)("div",{className:"relative h-96 bg-gradient-to-br from-red-100 to-pink-100",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent z-10"}),t.photos.length>1&&(0,a.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-20",children:(0,a.jsx)("div",{className:"flex space-x-2",children:t.photos.map((e,t)=>(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(t===s?"bg-white":"bg-white/50")},t))})}),t.photos.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{l(e=>0===e?t.photos.length-1:e-1)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-20 w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:"‹"}),(0,a.jsx)("button",{onClick:()=>{l(e=>e===t.photos.length-1?0:e+1)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-20 w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:"›"})]}),(0,a.jsx)("div",{className:"absolute top-4 right-4 z-20",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-1 rounded-full ".concat(t.isOnline?"bg-green-500 text-white":"bg-gray-500 text-white"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(t.isOnline?"bg-white":"bg-gray-300")}),(0,a.jsx)("span",{className:"text-sm font-medium",children:t.isOnline?"在线":"离线"})]})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-6 z-10",children:(0,a.jsxs)("div",{className:"flex items-end justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-white mb-1",children:[t.name,", ",t.age]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-white/90 mb-2",children:[(0,a.jsx)(m,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:t.location})]})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)("button",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:(0,a.jsx)(h.Z,{className:"h-5 w-5"})})})]})})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("p",{className:"text-gray-700 mb-4 leading-relaxed",children:t.bio}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"兴趣爱好"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t.interests.map((e,t)=>(0,a.jsx)("span",{className:"px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full",children:e},t))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[t.age,"岁"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(m,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:t.location})]})]})]})]})}let g=(0,o.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),p=(0,o.Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),b=(0,o.Z)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),j=(0,o.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);function y(e){let{matchedUsers:t,onClose:s}=e,[l,n]=(0,r.useState)(null),[c,i]=(0,r.useState)([]),[o,d]=(0,r.useState)(""),x=(0,r.useRef)(null);(0,r.useEffect)(()=>{l&&i([{id:"1",senderId:l.id,receiverId:"current-user",content:"你好！很高兴认识你 \uD83D\uDE0A",timestamp:new Date(Date.now()-36e5),type:"text"},{id:"2",senderId:"current-user",receiverId:l.id,content:"你好！我也很高兴认识你",timestamp:new Date(Date.now()-35e5),type:"text"},{id:"3",senderId:l.id,receiverId:"current-user",content:"看到你的资料，我们有很多共同的兴趣爱好呢",timestamp:new Date(Date.now()-3e6),type:"text"}])},[l]),(0,r.useEffect)(()=>{var e;null===(e=x.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[c]);let h=()=>{if(o.trim()&&l){let e={id:Date.now().toString(),senderId:"current-user",receiverId:l.id,content:o.trim(),timestamp:new Date,type:"text"};i(t=>[...t,e]),d(""),setTimeout(()=>{let e={id:(Date.now()+1).toString(),senderId:l.id,receiverId:"current-user",content:"收到你的消息了！我正在回复...",timestamp:new Date,type:"text"};i(t=>[...t,e])},2e3)}},m=e=>e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"聊天"}),(0,a.jsx)("button",{onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",children:(0,a.jsx)(g,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,a.jsx)("div",{className:"w-80 border-r bg-gray-50",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"匹配的用户"}),(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsx)("div",{onClick:()=>n(e),className:"p-3 rounded-lg cursor-pointer transition-colors ".concat((null==l?void 0:l.id)===e.id?"bg-red-100 border-red-200":"bg-white hover:bg-gray-100"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-red-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-red-600 font-medium",children:e.name.charAt(0)})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.age,"岁 \xb7 ",e.location]})]}),e.isOnline&&(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"})]})},e.id))})]})}),(0,a.jsx)("div",{className:"flex-1 flex flex-col",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-4 border-b bg-white",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-red-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-red-600 font-medium",children:l.name.charAt(0)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:l.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:l.isOnline?"在线":"离线"})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[c.map(e=>(0,a.jsx)("div",{className:"flex ".concat("current-user"===e.senderId?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ".concat("current-user"===e.senderId?"bg-red-500 text-white":"bg-gray-200 text-gray-900"),children:[(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat("current-user"===e.senderId?"text-red-100":"text-gray-500"),children:m(e.timestamp)})]})},e.id)),(0,a.jsx)("div",{ref:x})]}),(0,a.jsx)("div",{className:"p-4 border-t bg-white",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",children:(0,a.jsx)(p,{className:"h-5 w-5"})}),(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h())},placeholder:"输入消息...",className:"w-full px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"})}),(0,a.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",children:(0,a.jsx)(b,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:h,disabled:!o.trim(),className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,a.jsx)(j,{className:"h-5 w-5"})})]})})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("span",{className:"text-gray-500 text-2xl",children:"\uD83D\uDCAC"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"选择聊天对象"}),(0,a.jsx)("p",{className:"text-gray-500",children:"从左侧选择一个匹配的用户开始聊天"})]})})})]})]})})}let N=(0,o.Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),v=(0,o.Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),w=(0,o.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{let s=localStorage.getItem("user");if(s&&e){let a={...JSON.parse(s),...e};return localStorage.setItem("user",JSON.stringify(a)),console.log("".concat(t,": localStorage中的用户数据已更新:"),a),a}}catch(e){console.error("".concat(t,": 更新localStorage失败:"),e)}return null};function S(e){let{onClose:t}=e,[s,l]=(0,r.useState)(!1),[n,c]=(0,r.useState)(!0),[i,o]=(0,r.useState)(null),[d,x]=(0,r.useState)({});(0,r.useEffect)(()=>{(async()=>{c(!0);try{let e=localStorage.getItem("token");if(!e)return;console.log("ProfileModal: 开始获取用户资料...");let t=await fetch("/api/user/profile?t=".concat(Date.now()),{headers:{Authorization:"Bearer ".concat(e),"Cache-Control":"no-cache",Pragma:"no-cache"}});if(t.ok){let e=await t.json();e.success?(console.log("ProfileModal: 获取到用户资料:",e.user),o(e.user),x(e.user)):console.error("ProfileModal: 获取用户资料失败:",e.error)}else console.error("ProfileModal: 获取用户资料请求失败:",t.status)}catch(e){console.error("ProfileModal: 获取用户资料异常:",e)}finally{c(!1)}})()},[]);let h=async()=>{if(i)try{let e=localStorage.getItem("token");if(!e)return;console.log("前端发送的数据:",d),console.log("bio字段值:",d.bio);let t=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(d)});if(t.ok){let s=await t.json();if(s.success){console.log("保存成功，重新获取用户资料...");let t=await fetch("/api/user/profile?t=".concat(Date.now()),{headers:{Authorization:"Bearer ".concat(e),"Cache-Control":"no-cache",Pragma:"no-cache"}});if(t.ok){let e=await t.json();e.success&&(console.log("获取到的最新数据:",e.user),o(e.user),x(e.user),k(e.user,"ProfileModal保存"))}l(!1),alert("保存成功！")}else alert(s.error||"保存失败")}else alert("保存失败，请稍后重试")}catch(e){console.error("保存用户资料失败:",e),alert("保存失败，请稍后重试")}},m=e=>{if(e.trim()){let t=d.interests||[];t.includes(e.trim())||x(s=>({...s,interests:[...t,e.trim()]}))}},u=e=>{let t=d.interests||[];x(s=>({...s,interests:t.filter((t,s)=>s!==e)}))};return n||n?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载中..."})]})})}):i?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"个人资料"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:h,className:"flex items-center space-x-1 px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[(0,a.jsx)(N,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"保存"})]}),(0,a.jsx)("button",{onClick:()=>{i&&x(i),l(!1)},className:"px-3 py-1 text-gray-600 hover:text-gray-800 transition-colors",children:"取消"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>l(!0),className:"flex items-center space-x-1 px-3 py-1 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[(0,a.jsx)(v,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"编辑"})]}),(0,a.jsx)("button",{onClick:async()=>{let e=localStorage.getItem("token");if(!e)return;let t=await fetch("/api/user/profile?t=".concat(Date.now()),{headers:{Authorization:"Bearer ".concat(e),"Cache-Control":"no-cache",Pragma:"no-cache"}});if(t.ok){let e=await t.json();e.success&&(o(e.user),x(e.user),k(e.user,"ProfileModal刷新"),alert("数据已刷新！"))}},className:"flex items-center space-x-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:(0,a.jsx)("span",{children:"刷新"})})]}),(0,a.jsx)("button",{onClick:t,className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",children:(0,a.jsx)(g,{className:"h-5 w-5"})})]})]}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("div",{className:"w-32 h-32 bg-gradient-to-br from-red-100 to-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("span",{className:"text-4xl font-bold text-red-500",children:i.name.charAt(0)})}),s&&(0,a.jsx)("button",{className:"absolute bottom-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:(0,a.jsx)(w,{className:"h-4 w-4"})})]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:"基本信息"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"姓名"}),s?(0,a.jsx)("input",{type:"text",value:d.name||"",onChange:e=>x(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"}):(0,a.jsx)("p",{className:"text-gray-900",children:i.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"年龄"}),(0,a.jsxs)("p",{className:"text-gray-900",children:[(e=>{let t=new Date,s=new Date(e),a=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth();return(r<0||0===r&&t.getDate()<s.getDate())&&a--,a})(i.birth_date),"岁"]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"所在地"}),s?(0,a.jsx)("input",{type:"text",value:d.location||"",onChange:e=>x(t=>({...t,location:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"}):(0,a.jsx)("p",{className:"text-gray-900",children:i.location||"未设置"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"个人简介"}),s?(0,a.jsx)("textarea",{value:d.bio||"",onChange:e=>x(t=>({...t,bio:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none",placeholder:"介绍一下你自己..."}):(0,a.jsx)("p",{className:"text-gray-700 leading-relaxed",children:i.bio||"这个人很神秘..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"兴趣爱好"}),s?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:(d.interests||[]).map((e,t)=>(0,a.jsxs)("span",{className:"flex items-center space-x-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full",children:[(0,a.jsx)("span",{children:e}),(0,a.jsx)("button",{onClick:()=>u(t),className:"text-red-500 hover:text-red-700",children:"\xd7"})]},t))}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"添加兴趣...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",onKeyPress:e=>{"Enter"===e.key&&(m(e.currentTarget.value),e.currentTarget.value="")}}),(0,a.jsx)("button",{onClick:e=>{let t=e.currentTarget.previousElementSibling;m(t.value),t.value=""},className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"添加"})]})]}):(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:(i.interests||[]).map((e,t)=>(0,a.jsx)("span",{className:"px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full",children:e},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"隐私设置"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"个人资料可见性"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"控制谁可以看到你的个人资料"})]}),(0,a.jsxs)("select",{className:"px-3 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,a.jsx)("option",{children:"所有人"}),(0,a.jsx)("option",{children:"仅匹配用户"}),(0,a.jsx)("option",{children:"仅好友"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"在线状态"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"显示你的在线状态"})]}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",defaultChecked:!0,className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"})]})]})]})]})]})]})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"无法加载用户资料"}),(0,a.jsx)("button",{onClick:t,className:"mt-4 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:"关闭"})]})})})}function C(){let e=(0,l.useRouter)(),[t,s]=(0,r.useState)(!0),[o,m]=(0,r.useState)(0),[u,g]=(0,r.useState)(!1),[p,b]=(0,r.useState)(!1),[j,N]=(0,r.useState)([]),[v,w]=(0,r.useState)(null),[C,D]=(0,r.useState)([]);(0,r.useEffect)(()=>{let t=localStorage.getItem("token"),a=localStorage.getItem("user");if(!t||!a){e.push("/");return}(async()=>{try{let s=JSON.parse(a);w(s),console.log("Dashboard初始化: 从API获取最新用户数据...");let r=await fetch("/api/user/profile?t=".concat(Date.now()),{headers:{Authorization:"Bearer ".concat(t),"Cache-Control":"no-cache",Pragma:"no-cache"}});if(r.ok){let e=await r.json();e.success?(console.log("Dashboard初始化: 获取到最新用户数据:",e.user),w(e.user),k(e.user,"Dashboard初始化")):console.error("Dashboard初始化: API返回错误:",e.error)}else if(console.error("Dashboard初始化: API请求失败:",r.status),401===r.status){localStorage.removeItem("token"),localStorage.removeItem("user"),e.push("/");return}}catch(t){console.error("Dashboard初始化: 解析用户数据失败:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),e.push("/");return}finally{s(!1)}})()},[e]);let I=e=>{let t=new Date,s=new Date(e),a=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth();return(r<0||0===r&&t.getDate()<s.getDate())&&a--,a};(0,r.useEffect)(()=>{!t&&v&&(async()=>{try{let e=localStorage.getItem("token");if(!e)return;let t=await fetch("/api/user/matches?limit=10",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();if(e.success){let t=e.users.map(e=>({id:e.id.toString(),name:e.name,age:I(e.birth_date),location:e.location||"未知",bio:e.bio||"这个人很神秘...",interests:e.interests||[],photos:[e.avatar_url||"/api/placeholder/400/600"],isOnline:e.is_online||!1}));D(t)}}}catch(e){console.error("获取推荐用户失败:",e)}})()},[t,v]);let z=async()=>{let e=C[o];if(e){try{let t=localStorage.getItem("token");if(!t)return;let s=await fetch("/api/user/matches",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({matchedUserId:e.id,action:"like"})});if(s.ok){let t=await s.json();t.success&&t.isMatch&&(N(t=>[...t,e]),alert("恭喜！你和".concat(e.name,"匹配成功了！")))}}catch(e){console.error("处理喜欢失败:",e)}m(e=>e+1)}},P=async()=>{let e=C[o];if(e){try{let t=localStorage.getItem("token");if(!t)return;await fetch("/api/user/matches",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({matchedUserId:e.id,action:"pass"})})}catch(e){console.error("处理跳过失败:",e)}m(e=>e+1)}},M=async()=>{let e=C[o];if(e){try{let t=localStorage.getItem("token");if(!t)return;let s=await fetch("/api/user/matches",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({matchedUserId:e.id,action:"super_like"})});if(s.ok){let t=await s.json();t.success&&t.isMatch&&(N(t=>[...t,e]),alert("恭喜！你和".concat(e.name,"匹配成功了！")))}}catch(e){console.error("处理超级喜欢失败:",e)}m(e=>e+1)}};if(t)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-100 via-purple-50 to-blue-100 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载中..."})]})});let A=C[o];return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-100 via-purple-50 to-blue-100",children:[(0,a.jsx)("nav",{className:"bg-white shadow-lg",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-red-500",children:"社交俱乐部"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>g(!0),className:"p-2 text-gray-600 hover:text-red-500 transition-colors",children:(0,a.jsx)(c.Z,{size:24})}),(0,a.jsx)("button",{onClick:()=>b(!0),className:"p-2 text-gray-600 hover:text-red-500 transition-colors",children:(0,a.jsx)(i.Z,{size:24})}),(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),e.push("/")},className:"p-2 text-gray-600 hover:text-red-500 transition-colors",children:(0,a.jsx)(d,{size:24})})]})]})})}),(0,a.jsx)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:A?(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)(f,{user:A}),(0,a.jsxs)("div",{className:"flex justify-center space-x-8 mt-8",children:[(0,a.jsx)(n.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:P,className:"w-16 h-16 bg-gray-400 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-gray-500 transition-colors",children:"✕"}),(0,a.jsx)(n.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:M,className:"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-blue-600 transition-colors",children:(0,a.jsx)(x.Z,{size:24})}),(0,a.jsx)(n.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:z,className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-red-600 transition-colors",children:(0,a.jsx)(h.Z,{size:24})})]})]}):(0,a.jsxs)("div",{className:"text-center py-20",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-700 mb-4",children:"没有更多推荐了"}),(0,a.jsx)("p",{className:"text-gray-500",children:"稍后再来看看吧！"})]})}),u&&(0,a.jsx)(y,{matchedUsers:j,onClose:()=>g(!1)}),p&&(0,a.jsx)(S,{onClose:()=>{b(!1),(async()=>{try{let e=localStorage.getItem("token");if(!e)return;console.log("Dashboard: 重新获取用户资料...");let t=await fetch("/api/user/profile?t=".concat(Date.now()),{headers:{Authorization:"Bearer ".concat(e),"Cache-Control":"no-cache",Pragma:"no-cache"}});if(t.ok){let e=await t.json();e.success&&(console.log("Dashboard: 获取到最新用户资料:",e.user),w(e.user),k(e.user,"Dashboard关闭ProfileModal"))}}catch(e){console.error("Dashboard: 重新获取用户资料失败:",e)}})()}})]})}}},function(e){e.O(0,[699,971,117,744],function(){return e(e.s=2982)}),_N_E=e.O()}]);