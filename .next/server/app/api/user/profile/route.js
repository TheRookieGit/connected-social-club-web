(()=>{var e={};e.id=744,e.ids=[744],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},7388:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>I,requestAsyncStorage:()=>x,routeModule:()=>_,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>m,PUT:()=>h,dynamic:()=>l});var i=t(49303),u=t(88716),o=t(60670),n=t(87070),a=t(41482),c=t.n(a),p=t(72438);let l="force-dynamic";function d(){try{return(0,p.eI)("https://ckhxivbcnagwgpzljzrl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNraHhpdmJjbmFnd2dwemxqenJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MjQwMzgsImV4cCI6MjA2OTEwMDAzOH0.ZxoO8QQ9G3tggQFRCHjdnulgv45KtVyx6B7TnqrdHx4")}catch(e){return console.error("Supabase client creation failed:",e),null}}function f(e){if(!e||!e.startsWith("Bearer "))return null;let r=e.substring(7);try{return c().verify(r,process.env.JWT_SECRET||"your-secret-key")}catch(e){return console.error("Token verification failed:",e),null}}async function m(e){try{let r=d();if(!r)return n.NextResponse.json({success:!1,error:"数据库连接失败"},{status:500});let t=e.headers.get("authorization"),s=f(t);if(!s)return n.NextResponse.json({success:!1,error:"未授权访问"},{status:401});let{data:i,error:u}=await r.from("users").select(`
        id,
        email,
        name,
        phone,
        birth_date,
        gender,
        avatar_url,
        bio,
        location,
        occupation,
        education,
        relationship_status,
        height,
        weight,
        is_online,
        last_seen,
        is_verified,
        is_premium,
        status,
        created_at,
        updated_at
      `).eq("id",s.userId).single();if(u||!i)return n.NextResponse.json({success:!1,error:"用户不存在"},{status:404});let{data:o,error:a}=await r.from("user_interests").select("interest").eq("user_id",s.userId),{data:c,error:p}=await r.from("user_preferences").select("*").eq("user_id",s.userId).single();return await r.from("user_activity_logs").insert({user_id:s.userId,activity_type:"profile_view",activity_data:{profile_id:s.userId}}),n.NextResponse.json({success:!0,user:{...i,interests:o?.map(e=>e.interest)||[],preferences:c||null}})}catch(e){return console.error("获取用户资料错误:",e),n.NextResponse.json({success:!1,error:"服务器错误"},{status:500})}}async function h(e){try{let r=d();if(!r)return n.NextResponse.json({success:!1,error:"数据库连接失败"},{status:500});let t=e.headers.get("authorization"),s=f(t);if(!s)return n.NextResponse.json({success:!1,error:"未授权访问"},{status:401});let i=await e.json(),u={};["name","phone","birth_date","gender","avatar_url","bio","location","occupation","education","relationship_status","height","weight"].forEach(e=>{void 0!==i[e]&&(u[e]=i[e])});let{data:o,error:a}=await r.from("users").update(u).eq("id",s.userId).select().single();if(a)return console.error("更新用户资料错误:",a),n.NextResponse.json({success:!1,error:"更新失败"},{status:500});if(i.interests&&Array.isArray(i.interests)&&(await r.from("user_interests").delete().eq("user_id",s.userId),i.interests.length>0)){let e=i.interests.map(e=>({user_id:s.userId,interest:e.trim()}));await r.from("user_interests").insert(e)}if(i.preferences){let{error:e}=await r.from("user_preferences").upsert({user_id:s.userId,...i.preferences});e&&console.error("更新用户偏好错误:",e)}return await r.from("user_activity_logs").insert({user_id:s.userId,activity_type:"profile_update",activity_data:{updated_fields:Object.keys(u)}}),n.NextResponse.json({success:!0,message:"资料更新成功",user:o})}catch(e){return console.error("更新用户资料错误:",e),n.NextResponse.json({success:!1,error:"服务器错误"},{status:500})}}let _=new i.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"/Users/vincent/Desktop/social club web/app/api/user/profile/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:y}=_,v="/api/user/profile/route";function I(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,482,438],()=>t(7388));module.exports=s})();